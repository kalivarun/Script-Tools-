# Browser Password Extraction using Chrome's Native Messaging
# This method works for Chrome-based browsers

# Check if Chrome is installed
$chromePath = "$env:LOCALAPPDATA\Google\Chrome\User Data"
if (Test-Path $chromePath) {
    Write-Host "Chrome found. Attempting to extract passwords..." -ForegroundColor Green
    
    # Create a temporary extension to extract passwords
    $manifest = @"
{
    "name": "Password Exporter",
    "version": "1.0",
    "description": "Exports saved passwords",
    "permissions": ["passwords"],
    "background": {
        "service_worker": "background.js"
    },
    "manifest_version": 3
}
"@

    $backgroundScript = @"
chrome.runtime.onInstalled.addListener(() => {
    chrome.passwordsPrivate.getSavedPasswordList(passwords => {
        let csvContent = "URL,Username,Password\\n";
        
        passwords.forEach(password => {
            csvContent += `"${password.url}","${password.username}","${password.password}"\\n`;
        });
        
        // Create download
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        chrome.downloads.download({
            url: url,
            filename: 'chrome_passwords.csv',
            saveAs: true
        });
    });
});
"@

    # Create temporary extension directory
    $tempDir = ".\chrome_temp_extension"
    New-Item -ItemType Directory -Path $tempDir -Force
    $manifest | Out-File "$tempDir\manifest.json" -Encoding UTF8
    $backgroundScript | Out-File "$tempDir\background.js" -Encoding UTF8

    Write-Host "Temporary extension created. Please manually load it in Chrome:" -ForegroundColor Yellow
    Write-Host "1. Open Chrome and go to: chrome://extensions/" -ForegroundColor Yellow
    Write-Host "2. Enable 'Developer mode'" -ForegroundColor Yellow
    Write-Host "3. Click 'Load unpacked' and select: $tempDir" -ForegroundColor Yellow
    Write-Host "4. The extension will automatically export passwords to a CSV file" -ForegroundColor Yellow
}
else {
    Write-Host "Chrome not found." -ForegroundColor Red
}
