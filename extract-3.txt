# Alternative ChromePass Download from different source
$tempDir = "$env:TEMP\ChromePass"
$outputFile = ".\BravePasswords.csv"

# Try multiple download sources
$downloadSources = @(
    "https://www.nirsoft.net/utils/chromepass.zip",
    "https://web.archive.org/web/20230000000000*/https://www.nirsoft.net/utils/chromepass.zip",
    "https://majorgeeks.com/files/details/chromepass.html"
)

New-Item -ItemType Directory -Path $tempDir -Force | Out-Null

foreach ($source in $downloadSources) {
    try {
        Write-Host "Trying download from: $source" -ForegroundColor Yellow
        
        $zipPath = "$tempDir\chromepass.zip"
        
        # Use BitsTransfer for more reliable downloads
        Start-BitsTransfer -Source $source -Destination $zipPath -ErrorAction Stop
        
        if (Test-Path $zipPath -PathType Leaf) {
            Write-Host "Download successful!" -ForegroundColor Green
            break
        }
    } catch {
        Write-Host "Download failed: $($_.Exception.Message)" -ForegroundColor Red
        continue
    }
}

if (Test-Path "$tempDir\chromepass.zip") {
    try {
        Expand-Archive -Path "$tempDir\chromepass.zip" -DestinationPath $tempDir -Force
        $chromePassExe = Get-ChildItem -Path $tempDir -Recurse -Filter "ChromePass.exe" | Select-Object -First 1
        
        if ($chromePassExe) {
            & $chromePassExe.FullName /scomma $outputFile
            Write-Host "Passwords extracted to $outputFile" -ForegroundColor Green
        }
    } catch {
        Write-Host "Extraction failed: $($_.Exception.Message)" -ForegroundColor Red
    }
} else {
    Write-Host "All download attempts failed. Trying manual approach..." -ForegroundColor Red
    
    # Manual download instructions
    Write-Host "`nMANUAL DOWNLOAD INSTRUCTIONS:" -ForegroundColor Yellow
    Write-Host "1. Open your web browser" -ForegroundColor White
    Write-Host "2. Go to: https://www.nirsoft.net/utils/chromepass.html" -ForegroundColor White
    Write-Host "3. Download ChromePass.zip" -ForegroundColor White
    Write-Host "4. Extract the ZIP file manually" -ForegroundColor White
    Write-Host "5. Run ChromePass.exe from the extracted folder" -ForegroundColor White
}

# Cleanup
Remove-Item $tempDir -Recurse -Force -ErrorAction SilentlyContinue
