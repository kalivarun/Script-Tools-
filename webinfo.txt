# Ask for domain input
$inputUrl = Read-Host "Enter website URL (with or without https://)"

# Add https:// if missing
if (-not $inputUrl.StartsWith("http")) {
    $inputUrl = "https://$inputUrl"
}

Write-Host "Fetching internal links from: $inputUrl"
Write-Host "--------------------------------------------------"

try {
    # Fetch HTML source
    $response = Invoke-WebRequest -Uri $inputUrl -UseBasicParsing -ErrorAction Stop
    $baseUri = [System.Uri]$inputUrl

    # Extract hrefs from <a> tags
    $links = @()
    foreach ($link in $response.Links) {
        if ($link.href) {
            # Make absolute if relative
            if ($link.href.StartsWith("/")) {
                $fullLink = "$($baseUri.Scheme)://$($baseUri.Host)$($link.href)"
            } elseif ($link.href.StartsWith("http")) {
                $fullLink = $link.href
            } else {
                continue
            }

            # Only include links from the same domain
            if ($fullLink -like "*$($baseUri.Host)*") {
                $links += $fullLink
            }
        }
    }

    # Remove duplicates
    $uniqueLinks = $links | Sort-Object -Unique

    Write-Host "`nDiscovered internal endpoints and directories:"
    foreach ($l in $uniqueLinks) {
        Write-Host $l
    }

} catch {
    Write-Host "Error fetching website: $_"
}
